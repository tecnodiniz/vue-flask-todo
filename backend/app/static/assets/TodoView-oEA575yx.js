import{e as m,r as g,o as v,f as x,a as s,w as p,d as S,s as T,l as D,v as A,x as V,y as $,F as U,z as N,A as b,T as B,B as F,C as O,D as R,E as q,q as z}from"./index-DykZGbG7.js";const H={class:"text-center pa-4"},J={__name:"DialogExludeComponent",setup(k){const n=m(!1);return(i,a)=>{const o=g("v-btn"),f=g("v-card"),l=g("v-dialog");return v(),x("div",H,[s(o,{onClick:a[0]||(a[0]=r=>n.value=!0),"append-icon":"mdi-delete-circle"},{default:p(()=>a[4]||(a[4]=[S(" Exclude ")])),_:1}),s(l,{modelValue:n.value,"onUpdate:modelValue":a[3]||(a[3]=r=>n.value=r),width:"auto"},{default:p(()=>[s(f,{"max-width":"400","prepend-icon":"mdi-update",text:"Are you sure?",title:"Delete?"},{actions:p(()=>[s(o,{class:"ms-auto",text:"Cancel",onClick:a[1]||(a[1]=r=>n.value=!1)}),s(o,{class:"ms-auto",text:"Confirm",onClick:a[2]||(a[2]=r=>i.$emit("delete-confirm"))})]),_:1})]),_:1},8,["modelValue"])])}}},Y={__name:"TodoView",setup(k){const n=m(!1),i=m(""),a=m(""),o=T([]),f=m(""),l=N();D(()=>{localStorage.getItem("token")?(o.splice(0,o.length),c()):location.href="/"}),A(()=>{localStorage.getItem("token")?(o.splice(0,o.length),f.value=localStorage.getItem("username"),c()):location.href="/"});const r=async e=>{try{const t={task:e,done:!1,todo_id:l.params.id};(await F(t)).data&&c()}catch(t){d(t)}},c=async()=>{try{const e=await V(l.params.id);if(e.data&&e.data.tasks)o.splice(0,o.length,...e.data.tasks);else throw new Error("Error fetching data")}catch(e){d(e)}},_=()=>{localStorage.setItem("task",JSON.stringify(o))},w=async e=>{if(localStorage.getItem("token"))try{const t=await O(e._id,{done:e.done});t.data&&(console.log(t.data.msg),c())}catch(t){d(t)}else _()},h=async e=>{if(localStorage.getItem("token"))try{const t=await R(e);t.data&&(console.log(t.data.msg),c())}catch(t){d(t)}else{const t=o.findIndex(u=>u._id==e);o.splice(t,1),_()}},y=async e=>{if(localStorage.getItem("token"))try{(await q(l.params.id)).data&&c()}catch(t){d(t)}else e&&(o.splice(0,o.length),_())},I=async()=>{const e=await z(l.params.id);try{e.data&&(console.log(e.data.msg),location.href="/user")}catch(t){d(t)}},E=async()=>{try{if((await b({})).data)console.log("logout");else throw new Error("Erro")}catch(e){console.log(e.message)}localStorage.removeItem("token"),localStorage.removeItem("username"),location.href="/"},C=()=>{console.warn("Error 401: UNAUTHORIZED"),i.value="Session Expired",a.value="Your session has been expired, please login again",n.value=!0},d=e=>{const{response:t}=e;t&&t.status===401?(C(),console.log(t.data.msg)):(console.log(e.message),i.value="Something got wrong",n.value=!0)};return(e,t)=>{const u=g("v-container");return v(),x(U,null,[s(u,{class:"text-center"},{default:p(()=>[s(B,{todos:o,onAddItem:r,onUpdateItem:w,onDeleteItem:h,onDeleteAll:y},null,8,["todos"]),s(J,{onDeleteConfirm:I})]),_:1}),s($,{msg:i.value,text:a.value,dialog:n.value,onClose:E},null,8,["msg","text","dialog"])],64)}}};export{Y as default};
