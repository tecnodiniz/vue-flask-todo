import{r as d,a as p,o as v,d as x,b as n,w as f,h as T,q as D,k as A,s as V,v as $,x as U,F as b,y as N,z as B,T as F,A as O,B as R,C as q,D as z,p as H}from"./index-Dzylny3Q.js";const J={class:"text-center pa-4"},M={__name:"DialogExludeComponent",setup(k){const l=d(!1);return(i,a)=>{const o=p("v-btn"),m=p("v-card"),u=p("v-dialog");return v(),x("div",J,[n(o,{onClick:a[0]||(a[0]=s=>l.value=!0),"append-icon":"mdi-delete-circle"},{default:f(()=>a[4]||(a[4]=[T(" Exclude ")])),_:1}),n(u,{modelValue:l.value,"onUpdate:modelValue":a[3]||(a[3]=s=>l.value=s),width:"auto"},{default:f(()=>[n(m,{"max-width":"400","prepend-icon":"mdi-update",text:"Are you sure?",title:"Delete?"},{actions:f(()=>[n(o,{class:"ms-auto",text:"Cancel",onClick:a[1]||(a[1]=s=>l.value=!1)}),n(o,{class:"ms-auto",text:"Confirm",onClick:a[2]||(a[2]=s=>i.$emit("delete-confirm"))})]),_:1})]),_:1},8,["modelValue"])])}}},Z={__name:"TodoView",setup(k){const l=d(!1),i=d(""),a=d(""),o=D([]),m=d(""),u=d(!1),s=N();A(()=>{localStorage.getItem("token")?(o.splice(0,o.length),u.value=!0,m.value=localStorage.getItem("username"),r()):location.href="/"}),V(()=>{localStorage.getItem("token")?(o.splice(0,o.length),m.value=localStorage.getItem("username"),r()):location.href="/"});const w=async e=>{try{const t={task:e,done:!1,todo_id:s.params.id};(await O(t)).data&&r()}catch(t){c(t)}},r=async()=>{try{const e=await $(s.params.id);if(e.data&&e.data.tasks)o.splice(0,o.length,...e.data.tasks);else throw new Error("Error fetching data")}catch(e){c(e)}},_=()=>{localStorage.setItem("task",JSON.stringify(o))},h=async e=>{if(localStorage.getItem("token"))try{const t=await R(e._id,{done:e.done});t.data&&(console.log(t.data.msg),r())}catch(t){c(t)}else _()},I=async e=>{if(localStorage.getItem("token"))try{const t=await q(e);t.data&&(console.log(t.data.msg),r())}catch(t){c(t)}else{const t=o.findIndex(g=>g._id==e);o.splice(t,1),_()}},y=async e=>{if(localStorage.getItem("token"))try{(await z(s.params.id)).data&&r()}catch(t){c(t)}else e&&(o.splice(0,o.length),_())},S=async()=>{const e=await H(s.params.id);try{e.data&&(console.log(e.data.msg),location.href="/user")}catch(t){c(t)}},C=async()=>{try{if((await B({})).data)console.log("logout");else throw new Error("Erro")}catch(e){console.log(e.message)}localStorage.removeItem("token"),localStorage.removeItem("username"),u.value=!1,location.href="/"},E=()=>{console.warn("Error 401: UNAUTHORIZED"),i.value="Session Expired",a.value="Your session has been expired, please login again",l.value=!0},c=e=>{const{response:t}=e;t&&t.status===401?(E(),console.log(t.data.msg)):(console.log(e.message),i.value="Something got wrong",l.value=!0)};return(e,t)=>{const g=p("v-container");return v(),x(b,null,[n(g,{class:"text-center"},{default:f(()=>[n(F,{todos:o,onAddItem:w,onUpdateItem:h,onDeleteItem:I,onDeleteAll:y},null,8,["todos"]),n(M,{onDeleteConfirm:S})]),_:1}),n(U,{msg:i.value,text:a.value,dialog:l.value,onClose:C},null,8,["msg","text","dialog"])],64)}}};export{Z as default};
